- id: '1686857009649'
  alias: Notification - Postkasten Einwurf
  description: 'Setze Helfer auf true bei Einwurf '
  trigger:
  - type: opened
    platform: device
    device_id: 3194e85fdd595fda73ac2101642fbaee
    entity_id: binary_sensor.briefkasten_einwurf_contact
    domain: binary_sensor
  condition: []
  action:
  - service: input_boolean.turn_on
    data: {}
    entity_id: input_boolean.briefkasten_status
  - service: notify.mobile_app_christians_iphone
    data:
      message: "Die Post ist da! \U0001F4EC"
      title: "Sweet Home \U0001F3E1"
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  mode: single
- id: '1686867402107'
  alias: States - Briefkasten Entleerung
  description: 'Setze Helfer auf false bei Entleerung '
  trigger:
  - type: opened
    platform: device
    device_id: 37e4b5e97956a09bc9df3564760f3c5f
    entity_id: binary_sensor.briefkasten_klappe_contact
    domain: binary_sensor
  condition: []
  action:
  - service: input_boolean.turn_off
    data: {}
    entity_id: input_boolean.briefkasten_status
  mode: single
- id: '1687360370770'
  alias: Notification - System/Addon Update
  description: ''
  use_blueprint:
    path: mdegat01/update_notifications.yaml
    input:
      send_to_ha: true
      reminder_hours: '24'
      mobile_app_device: 57cc660bf24ad3bfb911d922985d0096
      mobile_app_device_2: 5b916f6c2a8e3ac7c68cee8a9f0612ff
      update_entities:
      - update.home_assistant_core_update
      - update.home_assistant_operating_system_update
      - update.home_assistant_supervisor_update
      - update.hacs_update
- id: '1688243312052'
  alias: Notification - Klingel Nachricht
  description: Sende Nachricht wenn jemand an der Haustür klingelt
  trigger:
  - platform: device
    domain: homematicip_local
    device_id: f12cc6440e04f0698fded750d72af250
    event_type: homematic.keypress
    address: 0026DBE998FDA3
    device_type: HmIP-DSD-PCB
    interface_id: RaspberryMatic-HmIP-RF
    type: press_short
    subtype: 1
  condition: []
  action:
  - service: camera.snapshot
    data:
      filename: /config/www/tmp/auffahrt_snapshot.jpg
    target:
      entity_id: camera.auffahrt_high
  - service: notify.mobile_app_christians_iphone
    data:
      message: Ding Dong! Jemand ist an der Tür!
      title: "Sweet Home \U0001F3E1"
      data:
        image: https://hass.christian-behrends.de/local/tmp/auffahrt_snapshot.jpg
        entity_id: camera.auffahrt_high
  mode: single
- id: '1688768107414'
  alias: Licht - Küche BWM
  description: ''
  use_blueprint:
    path: Blackshome/sensor-light.yaml
    input:
      motion_trigger:
      - binary_sensor.anwesenheit_sensoren_kuche
      light_switch:
        entity_id: scene.kuche_tag
      end_scenes:
      - scene.kuche_aus
      time_delay: 1
      include_bypass: bypass_enabled_turn_on
      bypass_time_delay: 0.25
      include_ambient: ambient_enabled
      ambient_light_sensor: sensor.sensorengruppe_helligkeit_kuche
      ambient_light_options: ambient_light_option_enabled
      include_night_lights: night_lights_enabled
      night_time_delay: 0.5
      night_lights_after_time: '23:00:00'
      night_lights_before_time: 07:00:00
      include_time: time_disabled
      after_time: 07:00:00
      before_time: '23:00:00'
      include_light_control:
      - use_transition
      night_lights:
        entity_id: scene.kuche_nacht
      night_lights_conditions:
      - time_enabled
      motion_bypass: input_boolean.licht_kuche_bypass
      include_night_light_control:
      - use_transition
      ambient_light_value: 20
      light_transition_on: 0.6
      light_transition_off: 0.6
      night_light_transition_on: 0.6
      night_light_transition_off: 0.6
      motion_bypass_lights_on:
      - input_boolean.licht_kuche_bypass
- id: '1688840530518'
  alias: Notification - Temperatur Aussen Innen
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.boiler_outside_temperatur
  condition:
  - condition: state
    entity_id: person.christian
    state: home
  action:
  - if:
    - condition: state
      entity_id: input_boolean.helfer_temperatur_a_h_i
      state: 'on'
    - condition: template
      value_template: '{{ (states(''sensor.boiler_room_temperatur'') | float - states(''sensor.boiler_outside_temperatur'')
        | float) >= 1.5 }}'
    then:
    - service: input_boolean.turn_off
      data: {}
      target:
        entity_id: input_boolean.helfer_temperatur_a_h_i
    - service: notify.mobile_app_christians_iphone
      data:
        title: "Sweet Home \U0001F3E1"
        message: Außentemperatur({{states.sensor.boiler_outside_temperatur.state}}°C)
          ist niedriger als Innentemperatur({{states.sensor.boiler_room_temperatur.state}}°C)
    else:
    - condition: numeric_state
      entity_id: sensor.boiler_outside_temperatur
      above: sensor.boiler_room_temperatur
    - service: input_boolean.turn_on
      data: {}
      target:
        entity_id: input_boolean.helfer_temperatur_a_h_i
  mode: single
- id: '1689530556005'
  alias: Anwesenheit - Ankommen / Verlassen
  description: "Ankommen: \n- Alarmanlage aus\n- Haustür aufschliessen\n- im Dunkeln
    Lichter  bypässe aktivieren\n- Rufumleitung deaktivieren\n\nVerlassen: \n- Alarmanlage
    an\n- Haustür abschliessen\n- Rufumleitung aktivieren"
  triggers:
  - entity_id:
    - sensor.home_christian_fahrtrichtung
    from: towards
    to: arrived
    for:
      hours: 0
      minutes: 0
      seconds: 0
    id: Anwesend
    trigger: state
  - entity_id:
    - sensor.home_christian_entfernung
    id: Abwesend
    for:
      hours: 0
      minutes: 3
      seconds: 0
    above: 1000
    trigger: numeric_state
  conditions:
  - condition: state
    entity_id: input_boolean.gastemodus
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Anwesend
      - condition: state
        entity_id: input_boolean.urlaubsmodus
        state: 'off'
      sequence:
      - data: {}
        target:
          entity_id:
          - alarm_control_panel.alarmanlage
        action: alarm_control_panel.alarm_disarm
      - data: {}
        action: lock.unlock
        target:
          entity_id:
          - lock.haustur
      - if:
        - condition: sun
          after: sunset
          after_offset: '-15'
        then:
        - data: {}
          target:
            entity_id: switch.auffahrt_licht
          action: switch.turn_on
        - data: {}
          target:
            entity_id:
            - input_boolean.licht_bypass_flur_eg
          action: input_boolean.turn_on
        - data: {}
          target:
            entity_id:
            - scene.kuche_tag
            - scene.wohnzimmer_abends_standart
          action: scene.turn_on
    - conditions:
      - condition: trigger
        id:
        - Abwesend
      sequence:
      - if:
        - condition: state
          entity_id: input_boolean.marlon_modus
          state: 'off'
        then:
        - data: {}
          target:
            entity_id: scene.schlafenszeit
          action: scene.turn_on
      - data: {}
        target:
          entity_id:
          - lock.haustur
        action: lock.lock
      - data: {}
        target:
          entity_id:
          - alarm_control_panel.alarmanlage
        action: alarm_control_panel.alarm_arm_home
  mode: single
- id: '1689950884736'
  alias: Notification - Heizung ausgefallen
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.boiler_locking
    for:
      hours: 0
      minutes: 1
      seconds: 0
    from: Keine Störung
  condition: []
  action:
  - if:
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.boiler_locking
        state: Keine Störung
    then:
    - service: notify.mobile_app_christians_iphone
      data:
        message: Die Heizung ist ausgefallen!
        title: "Sweet Home \U0001F3E1"
        data:
          actions:
          - action: Heizung_reset
            title: Heizung reset
            icon: mdi:restart
    else:
    - service: notify.mobile_app_christians_iphone
      data:
        title: "Sweet Home \U0001F3E1"
        message: Die Heizung läuft wieder!
  mode: single
- id: '1689951494669'
  alias: Licht - Terrasse Sonnenuntergang
  description: ''
  trigger:
  - platform: sun
    event: sunset
    offset: 0
    id: Sonnenuntergang
  - platform: time
    at: 00:00:00
    id: 0 Uhr
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Sonnenuntergang
      sequence:
      - metadata: {}
        target:
          entity_id: scene.terrasse_abend
        action: scene.turn_on
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 25
        target:
          entity_id: light.terrasse_leuchtkugel
    - conditions:
      - condition: trigger
        id:
        - 0 Uhr
      sequence:
      - type: turn_off
        device_id: 64d50194e3b193a20bfe154775cb4077
        entity_id: eacc108d5b64af3252ae9e6ab6e996e5
        domain: light
      - type: turn_off
        device_id: f4815c5c151df0711edca3935e446055
        entity_id: f9da9ba0761d40bbcdf48780533add98
        domain: light
      - type: turn_off
        device_id: aeb95c0bbf647a2159cdc90d02f80fcc
        entity_id: 3205dd9bcd0efa2bc13b5bcba721bcec
        domain: light
  mode: single
- id: '1690228220678'
  alias: Notification - Fenster/Tür geöffnet
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.fenster_zuletzt_geoffnet
    id: fenster
    from:
    to:
  - platform: state
    entity_id:
    - sensor.tur_zuletzt_geoffnet
    id: tür
    from:
    to:
  condition:
  - condition: state
    entity_id: person.christian
    state: not_home
  - condition: state
    entity_id: input_boolean.gastemodus
    state: 'off'
  - condition: state
    entity_id: alarm_control_panel.alarmanlage
    state: disarmed
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - tür
      sequence:
      - data:
          title: Sicherheitssystem
          message: 'Achtung! Folgende Tür wurde geöffnet: {{states(''sensor.tur_zuletzt_geoffnet'')}}'
          data:
            push:
              sound:
                name: default
                critical: 1
                volume: 1
        action: notify.notify
    - conditions:
      - condition: trigger
        id:
        - fenster
      sequence:
      - data:
          title: Sicherheitssystem
          message: 'Achtung! Folgendes Fenster wurde geöffnet: {{states(''sensor.fenster_zuletzt_geoffnet'')}}'
          data:
            push:
              sound:
                name: default
                critical: 1
                volume: 1
        action: notify.notify
  mode: single
- id: '1690543145284'
  alias: Licht - Büro
  description: ''
  use_blueprint:
    path: Blackshome/sensor-light.yaml
    input:
      motion_trigger:
      - binary_sensor.buro_bewegungsmelder_occupancy
      light_switch:
        entity_id: scene.buro_tag
      end_scenes:
      - scene.buro_alles_aus
      time_delay: 2
      include_bypass: bypass_enabled_turn_on
      include_ambient: ambient_enabled
      ambient_light_sensor: sensor.buro_bewegungsmelder_illuminance
      ambient_light_options: ambient_light_option_enabled
      ambient_light_value: 10
      include_night_lights: night_lights_enabled
      night_lights:
        entity_id: scene.buro_nacht
      night_time_delay: 0.5
      night_lights_conditions:
      - time_enabled
      night_lights_after_time: '23:00:00'
      night_lights_before_time: 07:00:00
      include_light_control:
      - use_transition
      - use_colour_temperature
      include_night_light_control:
      - use_transition
      light_transition_on: 0.6
      night_light_transition_on: 0.6
      night_light_transition_off: 0.6
      light_transition_off: 0.6
      motion_bypass: input_boolean.licht_buro_bypass
      motion_bypass_lights_on:
      - input_boolean.licht_buro_bypass
- id: '1691158909569'
  alias: Licht - Auffahrt
  description: ''
  use_blueprint:
    path: Blackshome/sensor-light.yaml
    input:
      motion_trigger:
      - binary_sensor.auffahrt_etwas_auf
      light_switch:
        entity_id: light.auffahrt_licht
      time_delay: 0.75
      motion_bypass: binary_sensor.auffahrt_etwas_auf
      include_bypass: []
      include_ambient: ambient_enabled
      ambient_light_sensor: sensor.auffahrt_bewegungsmelder_illuminance
      ambient_light_options: ambient_light_option_disabled
      ambient_light_value: 35
      bypass_time_delay: 0.75
      night_lights_conditions: []
      motion_bypass_lights_on: []
- id: '1691166473313'
  alias: Licht - Wohnzimmer BWM
  description: ''
  use_blueprint:
    path: Blackshome/sensor-light.yaml
    input:
      motion_trigger:
      - binary_sensor.wohnzimmer_bmw_bewegung
      light_switch:
        entity_id: scene.wohnzimmer_abends_standart
      end_scenes:
      - scene.wohnzimmer_alles_aus
      time_delay: 1.5
      include_ambient: ambient_enabled
      ambient_light_sensor: sensor.wohnzimmer_bmw_beleuchtungsstarke
      ambient_light_options: ambient_light_option_enabled
      ambient_light_value: 2
      motion_bypass: input_boolean.licht_wohnzimmer_bypass
      include_bypass: bypass_enabled_turn_on
      include_bypass_auto_off: bypass_auto_off_disabled
      light_transition_on: 0.6
      light_transition_off: 0.6
      night_light_transition_on: 0.6
      night_light_transition_off: 0.6
      include_light_control:
      - use_transition
      motion_bypass_lights_on:
      - input_boolean.licht_wohnzimmer_bypass
      bypass_time_delay: 0.25
      ambient_light_high_value: 3
- id: '1691242530952'
  alias: Roku - Harmony Hub Tasten
  description: ''
  trigger:
  - platform: event
    event_type: roku_command
    event_data:
      source_name: Home Assistant
      type: keypress
      key: Left
    id: Left
  - platform: event
    event_type: roku_command
    event_data:
      source_name: Home Assistant
      type: keypress
      key: Right
    id: Right
  - platform: event
    event_type: roku_command
    event_data:
      source_name: Home Assistant
      type: keypress
      key: Back
    id: Back
  - platform: event
    event_type: roku_command
    event_data:
      source_name: Home Assistant
      type: keypress
      key: BackSpace
    id: BackSpace
  - platform: event
    event_type: roku_command
    event_data:
      source_name: Home Assistant
      type: keypress
      key: Rev
    id: Rev
  - platform: event
    event_type: roku_command
    event_data:
      source_name: Home Assistant
      type: keypress
      key: Fwd
    id: Fwd
  - platform: event
    event_type: roku_command
    event_data:
      source_name: Home Assistant
      type: keypress
      key: Down
    id: Down
  - platform: event
    event_type: roku_command
    event_data:
      source_name: Home Assistant
      type: keypress
      key: Up
    id: Up
  - platform: event
    event_type: roku_command
    event_data:
      source_name: Home Assistant
      type: keypress
      key: Play
    id: Play
  - platform: event
    event_type: roku_command
    event_data:
      source_name: Home Assistant
      type: keypress
      key: Info
    id: Info
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Left
      sequence:
      - type: turn_on
        device_id: de7197e94a0d1bef2ec930ea9c234e31
        entity_id: d505cf6ac79696588bc59e7e8779c3a4
        domain: light
        brightness_pct: 25
    - conditions:
      - condition: trigger
        id:
        - Right
      sequence:
      - type: turn_off
        device_id: de7197e94a0d1bef2ec930ea9c234e31
        entity_id: d505cf6ac79696588bc59e7e8779c3a4
        domain: light
    - conditions:
      - condition: trigger
        id:
        - Back
      sequence:
      - type: turn_on
        device_id: 5dd52aca928925cdcbb25506b63c1eb8
        entity_id: 8ecfdad40bfa5e0746ce55ca0c37d73b
        domain: light
    - conditions:
      - condition: trigger
        id:
        - BackSpace
      sequence:
      - type: turn_off
        device_id: 5dd52aca928925cdcbb25506b63c1eb8
        entity_id: 8ecfdad40bfa5e0746ce55ca0c37d73b
        domain: light
    - conditions:
      - condition: trigger
        id:
        - Rev
      sequence:
      - type: turn_on
        device_id: 279ef68ea0c5a74e292f44af7f332043
        entity_id: c5b8607bdc1d3285a0d6b0133e6edea5
        domain: light
        brightness_pct: 15
    - conditions:
      - condition: trigger
        id:
        - Fwd
      sequence:
      - type: turn_off
        device_id: 279ef68ea0c5a74e292f44af7f332043
        entity_id: c5b8607bdc1d3285a0d6b0133e6edea5
        domain: light
    - conditions:
      - condition: trigger
        id:
        - Down
      sequence:
      - service: media_player.turn_on
        data: {}
        target:
          device_id: 3c188dd62678660180b3c7fbe72fa0b5
    - conditions:
      - condition: trigger
        id:
        - Up
      sequence:
      - service: media_player.turn_off
        data: {}
        target:
          device_id: 3c188dd62678660180b3c7fbe72fa0b5
    - conditions:
      - condition: trigger
        id:
        - Play
      sequence:
      - if:
        - condition: and
          conditions:
          - condition: device
            type: is_on
            device_id: de7197e94a0d1bef2ec930ea9c234e31
            entity_id: d505cf6ac79696588bc59e7e8779c3a4
            domain: light
          - condition: device
            type: is_on
            device_id: 279ef68ea0c5a74e292f44af7f332043
            entity_id: c5b8607bdc1d3285a0d6b0133e6edea5
            domain: light
        then:
        - device_id: de7197e94a0d1bef2ec930ea9c234e31
          domain: light
          entity_id: d505cf6ac79696588bc59e7e8779c3a4
          type: brightness_increase
        - device_id: 279ef68ea0c5a74e292f44af7f332043
          domain: light
          entity_id: c5b8607bdc1d3285a0d6b0133e6edea5
          type: brightness_increase
      - if:
        - condition: and
          conditions:
          - condition: device
            type: is_on
            device_id: de7197e94a0d1bef2ec930ea9c234e31
            entity_id: d505cf6ac79696588bc59e7e8779c3a4
            domain: light
          - condition: device
            type: is_off
            device_id: 279ef68ea0c5a74e292f44af7f332043
            entity_id: c5b8607bdc1d3285a0d6b0133e6edea5
            domain: light
        then:
        - device_id: de7197e94a0d1bef2ec930ea9c234e31
          domain: light
          entity_id: d505cf6ac79696588bc59e7e8779c3a4
          type: brightness_increase
      - if:
        - condition: and
          conditions:
          - condition: device
            type: is_off
            device_id: de7197e94a0d1bef2ec930ea9c234e31
            entity_id: d505cf6ac79696588bc59e7e8779c3a4
            domain: light
          - condition: device
            type: is_on
            device_id: 279ef68ea0c5a74e292f44af7f332043
            entity_id: c5b8607bdc1d3285a0d6b0133e6edea5
            domain: light
        then:
        - device_id: 279ef68ea0c5a74e292f44af7f332043
          domain: light
          entity_id: c5b8607bdc1d3285a0d6b0133e6edea5
          type: brightness_increase
    - conditions:
      - condition: trigger
        id:
        - Info
      sequence:
      - if:
        - condition: and
          conditions:
          - condition: device
            type: is_on
            device_id: de7197e94a0d1bef2ec930ea9c234e31
            entity_id: d505cf6ac79696588bc59e7e8779c3a4
            domain: light
          - condition: device
            type: is_on
            device_id: 279ef68ea0c5a74e292f44af7f332043
            entity_id: c5b8607bdc1d3285a0d6b0133e6edea5
            domain: light
        then:
        - device_id: de7197e94a0d1bef2ec930ea9c234e31
          domain: light
          entity_id: d505cf6ac79696588bc59e7e8779c3a4
          type: brightness_decrease
        - device_id: 279ef68ea0c5a74e292f44af7f332043
          domain: light
          entity_id: c5b8607bdc1d3285a0d6b0133e6edea5
          type: brightness_decrease
      - if:
        - condition: and
          conditions:
          - condition: device
            type: is_on
            device_id: de7197e94a0d1bef2ec930ea9c234e31
            entity_id: d505cf6ac79696588bc59e7e8779c3a4
            domain: light
          - condition: device
            type: is_off
            device_id: 279ef68ea0c5a74e292f44af7f332043
            entity_id: c5b8607bdc1d3285a0d6b0133e6edea5
            domain: light
        then:
        - device_id: de7197e94a0d1bef2ec930ea9c234e31
          domain: light
          entity_id: d505cf6ac79696588bc59e7e8779c3a4
          type: brightness_decrease
      - if:
        - condition: and
          conditions:
          - condition: device
            type: is_off
            device_id: de7197e94a0d1bef2ec930ea9c234e31
            entity_id: d505cf6ac79696588bc59e7e8779c3a4
            domain: light
          - condition: device
            type: is_on
            device_id: 279ef68ea0c5a74e292f44af7f332043
            entity_id: c5b8607bdc1d3285a0d6b0133e6edea5
            domain: light
        then:
        - device_id: 279ef68ea0c5a74e292f44af7f332043
          domain: light
          entity_id: c5b8607bdc1d3285a0d6b0133e6edea5
          type: brightness_decrease
  mode: single
- id: '1691246057609'
  alias: Licht - Wohnzimmer
  description: ''
  triggers:
  - entity_id:
    - sensor.wohnzimmer_bmw_beleuchtungsstarke
    id: Lichtsensor
    trigger: state
  - type: changed_states
    device_id: 3c188dd62678660180b3c7fbe72fa0b5
    entity_id: ff67403aea50b386e1ea601b15bd44b5
    domain: media_player
    trigger: device
    id: AVR
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - AVR
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: media_player.home_theater
            state: 'on'
          sequence:
          - data: {}
            target:
              entity_id: input_boolean.licht_wohnzimmer_bypass
            action: input_boolean.turn_on
          - type: turn_on
            device_id: 5dd52aca928925cdcbb25506b63c1eb8
            entity_id: 8ecfdad40bfa5e0746ce55ca0c37d73b
            domain: light
          - if:
            - condition: sun
              before: sunrise
              after: sunset
            then:
            - data: {}
              target:
                entity_id: scene.wohnzimmer_abends_tv
              action: scene.turn_on
        - conditions:
          - condition: state
            entity_id: media_player.home_theater
            state: 'off'
          sequence:
          - data: {}
            target:
              entity_id: input_boolean.licht_wohnzimmer_bypass
            enabled: true
            action: input_boolean.turn_off
    - conditions:
      - condition: trigger
        id:
        - Lichtsensor
      - condition: state
        entity_id: media_player.home_theater
        state: 'on'
      - condition: sun
        before: sunset
        after: sunrise
      sequence:
      - choose:
        - conditions:
          - condition: numeric_state
            entity_id: sensor.wohnzimmer_bmw_beleuchtungsstarke
            above: 0.25
          sequence:
          - type: turn_off
            device_id: c63362514c42d9112b345678b7bb22c4
            entity_id: fb568fd70ae4c6d19f9ac33a799a0820
            domain: light
          - type: turn_off
            device_id: b1dcc8d31f804c45a194bc06e499aa2b
            entity_id: ed965fd4b64c4b408c45c2a99705dd62
            domain: light
        - conditions:
          - condition: numeric_state
            entity_id: sensor.wohnzimmer_bmw_beleuchtungsstarke
            below: 0.25
          sequence:
          - target:
              entity_id: scene.wohnzimmer_abends_tv
            metadata: {}
            action: scene.turn_on
            data: {}
  mode: single
- id: '1691254885537'
  alias: Licht - Küche - Schalter
  description: ''
  trigger:
  - platform: device
    type: changed_states
    device_id: bfa03b529527c661ef264625ca77e5e3
    entity_id: 5da488ca0136264de0f413952e730864
    domain: light
  condition: []
  action:
  - if:
    - condition: device
      type: is_on
      device_id: bfa03b529527c661ef264625ca77e5e3
      entity_id: 5da488ca0136264de0f413952e730864
      domain: light
    then:
    - service: input_boolean.turn_on
      data: {}
      target:
        entity_id: input_boolean.licht_kuche_bypass
    - service: scene.turn_on
      target:
        entity_id: scene.kuche_tag
      metadata: {}
    else:
    - if:
      - condition: state
        entity_id: binary_sensor.anwesenheit_sensoren_kuche
        state: 'on'
      then:
      - wait_for_trigger:
        - platform: state
          entity_id:
          - binary_sensor.anwesenheit_sensoren_kuche
          from: 'on'
          to: 'off'
    - delay:
        hours: 0
        minutes: 0
        seconds: 15
        milliseconds: 0
    - service: scene.turn_on
      target:
        entity_id: scene.kuche_aus
      metadata: {}
    - service: input_boolean.turn_off
      data: {}
      target:
        entity_id: input_boolean.licht_kuche_bypass
  mode: single
- id: '1691346643021'
  alias: Licht - Wohnzimmer Ambilight
  description: ''
  triggers:
  - entity_id:
    - media_player.home_theater
    trigger: state
  - entity_id:
    - sensor.wohnzimmer_bmw_beleuchtungsstarke
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.wohnzimmer_bmw_beleuchtungsstarke
        below: 0.5
      - condition: state
        entity_id: media_player.home_theater
        state: 'on'
        enabled: true
      sequence:
      - metadata: {}
        target:
          entity_id: scene.ambilight_standart
        action: scene.turn_on
        data: {}
    - conditions:
      - condition: numeric_state
        entity_id: sensor.wohnzimmer_bmw_beleuchtungsstarke
        above: 0.5
      - condition: state
        entity_id: media_player.home_theater
        state: 'on'
        enabled: true
      sequence:
      - type: turn_off
        device_id: 279ef68ea0c5a74e292f44af7f332043
        entity_id: c5b8607bdc1d3285a0d6b0133e6edea5
        domain: light
    - conditions:
      - condition: device
        device_id: 3c188dd62678660180b3c7fbe72fa0b5
        domain: media_player
        entity_id: ff67403aea50b386e1ea601b15bd44b5
        type: is_off
      sequence:
      - delay:
          hours: 0
          minutes: 0
          seconds: 3
          milliseconds: 0
      - type: turn_off
        device_id: 279ef68ea0c5a74e292f44af7f332043
        entity_id: c5b8607bdc1d3285a0d6b0133e6edea5
        domain: light
  mode: single
- id: '1691347518564'
  alias: Licht - Küche Taster
  description: ''
  trigger:
  - platform: device
    domain: homematicip_local
    device_id: 10837ea5adf8ea7a790b10654350e9c3
    event_type: homematic.keypress
    address: 0019DBE98FACBB
    device_type: HmIP-BRC2
    interface_id: RaspberryMatic-HmIP-RF
    type: press_short
    subtype: 1
    id: 1short
  - platform: device
    domain: homematicip_local
    device_id: 10837ea5adf8ea7a790b10654350e9c3
    event_type: homematic.keypress
    address: 0019DBE98FACBB
    device_type: HmIP-BRC2
    interface_id: RaspberryMatic-HmIP-RF
    type: press_long_start
    subtype: 1
    id: 1longstart
  - platform: device
    domain: homematicip_local
    device_id: 10837ea5adf8ea7a790b10654350e9c3
    event_type: homematic.keypress
    address: 0019DBE98FACBB
    device_type: HmIP-BRC2
    interface_id: RaspberryMatic-HmIP-RF
    type: press_long_start
    subtype: 2
    id: 2longstart
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - 1short
      sequence:
      - if:
        - condition: and
          conditions:
          - condition: device
            type: is_off
            device_id: 05584a982384dd3ebce9dc1f642d5af1
            entity_id: a6fe265cafe99597f48ed90a5f69ded2
            domain: light
          - condition: device
            type: is_off
            device_id: 6bda2bf0734100841eb3c21bb8f47a72
            entity_id: 34d30d9d2530a4b98f239d1cb464db38
            domain: light
        then:
        - service: scene.turn_on
          target:
            entity_id: scene.kuche_tag
          metadata: {}
        else:
        - service: scene.turn_on
          target:
            entity_id: scene.kuche_aus
          metadata: {}
    - conditions:
      - condition: trigger
        id:
        - 1longstart
      sequence:
      - device_id: 05584a982384dd3ebce9dc1f642d5af1
        domain: light
        entity_id: a6fe265cafe99597f48ed90a5f69ded2
        type: brightness_decrease
      - device_id: 6bda2bf0734100841eb3c21bb8f47a72
        domain: light
        entity_id: 34d30d9d2530a4b98f239d1cb464db38
        type: brightness_decrease
    - conditions:
      - condition: trigger
        id:
        - 2longstart
      sequence:
      - device_id: 05584a982384dd3ebce9dc1f642d5af1
        domain: light
        entity_id: a6fe265cafe99597f48ed90a5f69ded2
        type: brightness_increase
      - device_id: 6bda2bf0734100841eb3c21bb8f47a72
        domain: light
        entity_id: 34d30d9d2530a4b98f239d1cb464db38
        type: brightness_increase
  mode: single
- id: '1691853001093'
  alias: Licht - Flur OG BWM
  description: ''
  use_blueprint:
    path: Blackshome/sensor-light.yaml
    input:
      motion_trigger:
      - binary_sensor.hmip_spi_000c20c9951e5f_anwesenheit
      light_switch:
        entity_id: scene.flur_og_tag
      end_scenes:
      - scene.flur_og_alles_aus
      time_delay: 0.5
      include_light_control:
      - use_transition
      include_bypass: bypass_enabled_turn_on
      motion_bypass: input_boolean.licht_bypass_flur_og
      ambient_light_sensor: sensor.hmip_spi_000c20c9951e5f_beleuchtungsstarke
      ambient_light_value: 15
      include_night_lights: night_lights_enabled
      night_lights:
        entity_id: scene.flur_og_nacht
      night_time_delay: 0.5
      include_night_light_control:
      - use_transition
      night_lights_conditions:
      - time_enabled
      night_lights_after_time: '23:00:00'
      night_lights_before_time: 07:00:00
      include_ambient: ambient_enabled
      ambient_light_options: ambient_light_option_enabled
      light_transition_on: 0.6
      night_light_transition_on: 0.6
      night_light_transition_off: 0.6
      light_transition_off: 0.6
      motion_bypass_lights_on:
      - input_boolean.licht_bypass_flur_og
- id: '1691853870855'
  alias: Licht - Flur Sonnenuntergang
  description: ''
  trigger:
  - platform: sun
    event: sunset
    offset: '-15'
  condition:
  - condition: state
    entity_id: person.christian
    state: home
  action:
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.licht_bypass_flur_og
    enabled: false
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.licht_bypass_flur_eg
  mode: single
- id: '1691854085278'
  alias: Licht - Flur EG - Bypass reset
  description: ''
  trigger:
  - platform: state
    entity_id:
    - light.licht_flur_eg
    from: 'on'
    to: 'off'
    id: Flur EG
  condition: []
  action:
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.licht_bypass_flur_eg
  mode: single
- id: '1691854740250'
  alias: Licht - Flur EG BWM
  description: ''
  use_blueprint:
    path: Blackshome/sensor-light.yaml
    input:
      motion_trigger:
      - binary_sensor.hmip_spi_000c20c9abc5de_anwesenheit
      end_scenes:
      - scene.flur_eg_alles_aus
      time_delay: 1
      include_light_control:
      - use_transition
      include_ambient: ambient_enabled
      ambient_light_sensor: sensor.hmip_spi_000c20c9abc5de_beleuchtungsstarke
      ambient_light_value: 10
      ambient_light_options: ambient_light_option_enabled
      light_switch:
        entity_id: scene.flur_eg_tag
      include_night_lights: night_lights_enabled
      night_lights:
        entity_id: scene.flur_eg_nacht
      night_time_delay: 0.5
      include_night_light_control:
      - use_transition
      night_lights_conditions:
      - time_enabled
      night_lights_after_time: '23:00:00'
      motion_bypass: input_boolean.licht_bypass_flur_eg
      include_bypass: bypass_enabled_turn_on
      light_transition_off: 0.6
      night_light_transition_on: 0.6
      night_light_transition_off: 0.6
      light_transition_on: 0.6
      motion_bypass_lights_on:
      - input_boolean.licht_bypass_flur_eg
      ambient_light_high_value: 30
- id: '1691856116897'
  alias: Licht - Flur Treppe BWM
  description: ''
  use_blueprint:
    path: Blackshome/sensor-light.yaml
    input:
      motion_trigger:
      - binary_sensor.sensoren_bwm_flur
      light_switch:
        entity_id: scene.flur_eg_treppe_tag
      end_scenes:
      - scene.flur_eg_treppe_aus
      time_delay: 1
      include_light_control:
      - use_transition
      include_bypass: bypass_enabled_turn_on
      motion_bypass: input_boolean.licht_bypass_flur_eg
      include_ambient: ambient_enabled
      ambient_light_sensor: sensor.hmip_spi_000c20c9abc5de_beleuchtungsstarke
      ambient_light_value: 5
      include_night_lights: night_lights_enabled
      night_lights:
        entity_id: scene.flur_eg_treppe_nacht
      night_time_delay: 0.5
      include_night_light_control:
      - use_transition
      night_lights_conditions:
      - time_enabled
      night_lights_after_time: '23:00:00'
      night_lights_before_time: 07:00:00
      light_transition_on: 0.6
      light_transition_off: 0.6
      night_light_transition_on: 0.6
      night_light_transition_off: 0.6
      motion_bypass_lights_on:
      - input_boolean.licht_bypass_flur_eg
- id: '1692485646205'
  alias: iPhone Nachtzeit
  description: ''
  triggers:
  - entity_id:
    - sensor.christians_iphone_battery_state
    from: Not Charging
    to: Charging
    trigger: state
  conditions:
  - condition: time
    after: '21:00:00'
    before: 05:00:00
  - condition: state
    entity_id: person.christian
    state: home
  actions:
  - target:
      entity_id: scene.schlafenszeit
    metadata: {}
    action: scene.turn_on
    data: {}
  - data: {}
    target:
      entity_id: alarm_control_panel.alarmanlage
    action: alarm_control_panel.alarm_arm_night
    enabled: false
  - data: {}
    target:
      entity_id:
      - lock.haustur
    action: lock.lock
  mode: single
- id: '1694034376577'
  alias: Alarmanlage - iPhone Focus aus
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.christians_iphone_focus
    from: 'on'
    to: 'off'
  conditions:
  - condition: zone
    entity_id: person.christian
    zone: zone.home
  actions:
  - data: {}
    target:
      entity_id:
      - alarm_control_panel.alarmanlage
    action: alarm_control_panel.alarm_disarm
  mode: single
- id: '1694190883186'
  alias: Licht - Garage
  description: ''
  use_blueprint:
    path: Blackshome/sensor-light.yaml
    input:
      motion_trigger:
      - binary_sensor.garage_sensoren_licht
      light_switch:
        entity_id: switch.garagenlicht
      time_delay: 0.75
- id: '1694645248760'
  alias: Notification - Saugroboter fertig
  description: ''
  trigger:
  - platform: state
    entity_id:
    - vacuum.roborock_s7
    from: cleaning
    to: returning
    id: Robbi
  - platform: state
    entity_id:
    - vacuum.schaumi
    from: cleaning
    to: returning
    id: Schaumi
  condition:
  - condition: not
    conditions:
    - condition: zone
      entity_id: person.christian
      zone: zone.home
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Robbi
      sequence:
      - service: notify.mobile_app_christians_iphone
        data:
          title: "Sweet Home \U0001F3E1"
          message: Erdgeschoss gereinigt. Robbi fährt zurück zur Dockingststion.
    - conditions:
      - condition: trigger
        id:
        - Schaumi
      sequence:
      - service: notify.mobile_app_christians_iphone
        data:
          title: "Sweet Home \U0001F3E1"
          message: Obergeschoss gereinigt. Schaumi fährt zurück zur Dockingststion.
  mode: single
- id: '1696672597427'
  alias: States - Robbi Entleeren
  description: ''
  triggers:
  - entity_id:
    - input_button.robbi_goto_entleeren
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: vacuum.roborock_s7
      state: docked
    then:
    - action: roborock.set_vacuum_goto_position
      target:
        entity_id: vacuum.roborock_s7
      data:
        x: '24800'
        y: '27500'
    else:
    - device_id: 79fd01e9b0d0e223fdfb3cbfc54a8531
      domain: vacuum
      entity_id: 4b07570880c15232354030e146cbc9ac
      type: dock
  - metadata: {}
    data:
      value: 0
    target:
      entity_id: input_number.robbi_behalter_inhalt
    action: input_number.set_value
  mode: single
- id: '1699487323096'
  alias: Licht - Flur OG - Bypass reset
  description: ''
  trigger:
  - platform: state
    entity_id:
    - light.licht_flur_og
    from: 'on'
    to: 'off'
    id: Flur OG
  condition: []
  action:
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.licht_bypass_flur_og
  mode: single
- id: '1701431072804'
  alias: Licht - Außen Weihnachtsbeleuchtung
  description: ''
  trigger:
  - platform: sun
    event: sunset
    offset: '-10'
    id: Sonnenuntergang
  - platform: time
    at: 00:00:00
    id: 0 Uhr
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Sonnenuntergang
      sequence:
      - type: turn_on
        device_id: d605beada98e90ead1687777cdcbdf4c
        entity_id: c492a11a23de222c1f95d588d5ba2cc0
        domain: switch
    - conditions:
      - condition: trigger
        id:
        - 0 Uhr
      sequence:
      - type: turn_off
        device_id: d605beada98e90ead1687777cdcbdf4c
        entity_id: c492a11a23de222c1f95d588d5ba2cc0
        domain: switch
  mode: single
- id: '1702407520076'
  alias: Licht - Büro - Bypass reset
  description: ''
  trigger:
  - platform: state
    entity_id:
    - light.licht_buro
    from: 'on'
    to: 'off'
    id: Büro
  condition: []
  action:
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.licht_buro_bypass
  mode: single
- id: '1703334058878'
  alias: Strom - Automatische Preisänderung
  description: ''
  triggers:
  - at: input_datetime.strom_preisanderungsdatum
    trigger: time
  conditions: []
  actions:
  - target:
      entity_id: input_number.strompreis
    data:
      value: '{{ states(''input_number.strom_neuer_preis_kwh'') | float }}'
    enabled: true
    action: input_number.set_value
  - data:
      message: 'Strompreis wurde angepasst. Neuer Preis: {{ states(''input_number.strom_neuer_preis_kwh'')
        | float }} €'
      title: "Sweet Home \U0001F3E1"
    action: notify.mobile_app_christians_iphone
  mode: single
- id: '1703495288851'
  alias: Gas - Automatische Preisänderung
  description: ''
  triggers:
  - at: input_datetime.gas_preisanderungsdatum
    trigger: time
  conditions: []
  actions:
  - target:
      entity_id: input_number.gaspreis
    data:
      value: '{{ states(''input_number.gas_neuer_preis_kwh'') | float }}'
    enabled: true
    action: input_number.set_value
  - data:
      message: 'Gaspreis wurde angepasst. Neuer Preis: {{ states(''input_number.gas_neuer_preis_kwh'')
        | float }} €'
      title: "Sweet Home \U0001F3E1"
    action: notify.mobile_app_christians_iphone
  mode: single
- id: '1712429461281'
  alias: Low Battery Notifications & Actions
  description: ''
  use_blueprint:
    path: Blackshome/low-battery-notifications-and-actions.yaml
    input:
      include_persistent_notification: enable_persistent_notification
      notify_device:
      - 8c8704041f95b4a801662374c49fc21f
      notify_action_buttons: disabled_notify_action_buttons
      time: 09:00:00
      include_easy_notify: enable_easy_notify
      battery_level: 15
      custom_group_battery_level: 25
      include_time: time_enabled
- id: '1713537887963'
  alias: Benachrichtigung - Rasperrymatic Servicemeldung
  description: ''
  trigger:
  - platform: numeric_state
    entity_id:
    - sensor.raspberrymatic_sv_servicemeldungen
    above: 0
    for:
      hours: 0
      minutes: 1
      seconds: 0
  condition: []
  action:
  - service: notify.persistent_notification
    metadata: {}
    data:
      title: "{% set anzahl_servicemeldungen = states('sensor.raspberrymatic_sv_servicemeldungen')
        | float | round %} {% if anzahl_servicemeldungen == 1 %} \n  Rasperrymatic
        Servicemeldung\n{% elif anzahl_servicemeldungen >= 2 %}\n  {{ anzahl_servicemeldungen
        }} Rasperrymatic Servicemeldungen\n{% endif %}"
      message: '{{ states.sensor.raspberrymatic_sv_servicemeldung_text.state }}'
  - service: notify.mobile_app_christians_iphone
    metadata: {}
    data:
      title: "{% set anzahl_servicemeldungen = states('sensor.raspberrymatic_sv_servicemeldungen')
        | float | round %} {% if anzahl_servicemeldungen == 1 %} \n  Rasperrymatic
        Servicemeldung\n{% elif anzahl_servicemeldungen >= 2 %}\n  {{ anzahl_servicemeldungen
        }} Rasperrymatic Servicemeldungen\n{% endif %}"
      message: '{{ states.sensor.raspberrymatic_sv_servicemeldung_text.state }}'
  mode: single
- id: '1715621926054'
  alias: Alarmanlage - Abwesend zu Anwesend (scharf)
  description: Wenn Saugroboter starten um BWM nicht auszulösen
  trigger:
  - platform: state
    entity_id:
    - vacuum.roborock_s7
    to: cleaning
  - platform: state
    entity_id:
    - vacuum.schaumi
    to: cleaning
  condition:
  - condition: state
    entity_id: alarm_control_panel.alarmanlage
    state: armed_away
  action:
  - service: alarm_control_panel.alarm_arm_home
    metadata: {}
    data: {}
    target:
      entity_id: alarm_control_panel.alarmanlage
  mode: single
- id: '1719089807113'
  alias: 'Robbi Behälter erhöhen '
  description: Wenn Robbi fertig erhöhe Inhalt vom Behälter um 1
  trigger:
  - platform: state
    entity_id:
    - vacuum.roborock_s7
    from: cleaning
    to: returning
  condition: []
  action:
  - service: input_number.increment
    metadata: {}
    data: {}
    target:
      entity_id: input_number.robbi_behalter_inhalt
  mode: single
- id: '1719090111515'
  alias: Benachrichtigung - Saugroboter Behälter leeren
  description: ''
  triggers:
  - entity_id:
    - input_number.robbi_behalter_inhalt
    above: 2
    trigger: numeric_state
  conditions: []
  actions:
  - metadata: {}
    data:
      title: "Sweet Home \U0001F3E1"
      message: Saugroboter Behälter sollten geleert werden.
    action: notify.mobile_app_christians_iphone
  mode: single
- id: '1724578250535'
  alias: Stromsparmodus
  description: ''
  triggers:
  - entity_id:
    - input_boolean.stromsparmodus
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.stromsparmodus
        state: 'on'
      sequence:
      - metadata: {}
        data: {}
        target:
          entity_id:
          - switch.steckdose_surround
          - switch.kuche_steckdose_tv
          - switch.0x0017880108e6f15d
          - switch.gastezimmer_steckdose_tv
          - switch.kuche_media_steckdose
          - switch.wohnzimmer_tv_steckdose
          - switch.wohnzimmer_robby_steckdose
          - switch.warmwasser_umwalzpumpe
        action: switch.turn_off
      - metadata: {}
        data:
          message: Achtung! Stromsparmodus aktiviert.
          title: "Sweet Home \U0001F3E1"
        action: notify.mobile_app_christians_iphone
    - conditions:
      - condition: state
        entity_id: input_boolean.stromsparmodus
        state: 'off'
      sequence:
      - action: switch.turn_on
        target:
          entity_id:
          - switch.steckdose_surround
          - switch.kuche_steckdose_tv
          - switch.0x0017880108e6f15d
          - switch.gastezimmer_steckdose_tv
          - switch.kuche_media_steckdose
          - switch.wohnzimmer_tv_steckdose
          - switch.wohnzimmer_robby_steckdose
          - switch.warmwasser_umwalzpumpe
        data: {}
      - metadata: {}
        data:
          message: Achtung! Stromsparmodus deaktiviert.
          title: "Sweet Home \U0001F3E1"
        action: notify.mobile_app_christians_iphone
  mode: single
- id: '1725203736691'
  alias: Waschmaschine Benachrichtigung
  description: ''
  use_blueprint:
    path: Blackshome/appliance-notifications.yaml
    input:
      power_sensor: sensor.waschmaschine_power
      start_appliance_power: 10
      end_appliance_power: 2
      end_repeat_count: 1
      end_time_delay: 1.5
      end_message: Die Waschmaschine ist fertig!
      end_message_title: "Sweet Home \U0001F3E1"
      end_notify_device:
      - 57cc660bf24ad3bfb911d922985d0096
      include_end_notify: enable_end_notify_options
      include_custom_actions:
      - enable_start_custom_actions
      - enable_end_custom_actions
      start_custom_actions:
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.waschmaschine
      end_custom_actions:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.waschmaschine
- id: '1725203953895'
  alias: Trockner Benachrichtigung
  description: ''
  use_blueprint:
    path: Blackshome/appliance-notifications.yaml
    input:
      power_sensor: sensor.trockner_power
      include_end_notify: enable_end_notify_options
      end_notify_device:
      - 57cc660bf24ad3bfb911d922985d0096
      end_message: Der Trockner ist fertig.
      end_message_title: "Sweet Home \U0001F3E1"
      start_time_delay: 3
      end_repeat_count: 2
- id: '1725204110417'
  alias: Geschirrspüler Benachrichtigung
  description: ''
  use_blueprint:
    path: Blackshome/appliance-notifications.yaml
    input:
      power_sensor: sensor.geschirrspueler_power
      end_appliance_power: 2
      end_time_delay: 3
      end_repeat_count: 1
      include_end_notify: enable_end_notify_options
      end_notify_device:
      - 57cc660bf24ad3bfb911d922985d0096
      end_message_title: "Sweet Home \U0001F3E1"
      end_message: Der Geschirrspühler ist fertig!
- id: '1725218615130'
  alias: Urlaubsmodus
  description: Wenn Urlaub oder Schicht ist
  trigger:
  - platform: state
    entity_id:
    - input_boolean.urlaubsmodus
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.urlaubsmodus
        state: 'on'
      sequence:
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.stromsparmodus
    - conditions:
      - condition: state
        entity_id: input_boolean.urlaubsmodus
        state: 'off'
      sequence:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.stromsparmodus
  mode: single
- id: '1725649566696'
  alias: Beleuchtung - Terrassenlicht automatisch Tür
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.wohnzimmer_terrassentur_links
    - binary_sensor.wohnzimmer_terrassentur_rechts
    from: 'off'
    to: 'on'
    id: Terrassentür auf
  - platform: state
    entity_id:
    - binary_sensor.wohnzimmer_terrassentur_links
    - binary_sensor.wohnzimmer_terrassentur_rechts
    from: 'on'
    to: 'off'
    id: Terrassentür zu
  condition:
  - condition: sun
    before: sunrise
    after: sunset
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Terrassentür auf
      sequence:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.terrasse_licht
    - conditions:
      - condition: trigger
        id:
        - Terrassentür zu
      sequence:
      - action: light.turn_off
        target:
          entity_id:
          - light.terrasse_licht
        data: {}
  mode: single
- id: '1726777157419'
  alias: ESPHome Update Checker
  description: Automatically update ESPHome Devices after ESPHome upgrade, and notify
    when they are updated.
  triggers:
  - entity_id:
    - input_boolean.update_esphome
    id: 'Switch to start update '
    from: 'off'
    to: 'on'
    trigger: state
  - trigger: state
    entity_id:
    - sensor.esphome_update_available
    from: 'True'
    to: 'False'
    id: Template keine Updates mehr
  - event_type: timer.finished
    event_data:
      entity_id: timer.esphome_updates_timer
    id: esphome_timer_updates_finished
    trigger: event
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - 'Switch to start update '
      - alias: Confirm something needs to be updated still
        condition: template
        value_template: "{{ \n  states.update | \n  selectattr('state', 'eq', 'on')
          | \n  map(attribute='entity_id') | \n  select('in', integration_entities('esphome'))
          | \n  list | count > 0\n}}"
      - condition: state
        entity_id: input_boolean.update_esphome
        state: 'on'
      sequence:
      - action: notify.mobile_app_christians_iphone
        data:
          title: ESPHome Devices
          message: "{% set entity = states.update | \n    selectattr('state', 'eq',
            'on') |\n    map(attribute='entity_id') | \n    select('in', integration_entities('esphome'))
            | \n    first\n%} \nYour ESPHome devices will now be updated from {{ state_attr(entity,
            \"installed_version\")  }} to {{ state_attr(entity, \"latest_version\")
            \ }}."
      - alias: Update all ESPHome devices in sequence
        repeat:
          for_each: "{{ states.update |\n    selectattr('state', 'eq', 'on') |\n    map(attribute='entity_id')
            | \n    select('in', integration_entities('esphome')) | \n    list\n}}"
          sequence:
          - action: timer.start
            data:
              duration: 0
            target:
              entity_id: timer.esphome_updates_timer
          - target:
              entity_id: '{{ repeat.item }}'
            action: update.install
          - wait_template: '{{ is_state(repeat.item, ''off'') }}'
          - action: timer.cancel
            target:
              entity_id: timer.esphome_updates_timer
            data: {}
    - conditions:
      - condition: trigger
        id:
        - Template keine Updates mehr
      sequence:
      - action: timer.cancel
        target:
          entity_id: timer.esphome_updates_timer
        data: {}
        enabled: true
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.update_esphome
      - action: notify.mobile_app_christians_iphone
        data:
          title: ESPHome Devices
          message: "{% set entity = states.update | \n    selectattr('state', 'eq',
            'off') |\n    map(attribute='entity_id') | \n    select('in', integration_entities('esphome'))
            | \n    first\n%} \nYour ESPHome devices are now all updated to {{ state_attr(entity,
            \"latest_version\") }}."
    - conditions:
      - condition: trigger
        id: esphome_timer_updates_finished
      sequence:
      - action: notify.mobile_app_christians_iphone
        data:
          title: ESPHome Devices
          message: "{% set entity = states.update | \n    selectattr('state', 'eq',
            'on') |\n    map(attribute='entity_id') | \n    select('in', integration_entities('esphome'))
            | \n    first\n%}  There was a problem updating to {{ state_attr(entity,
            \"latest_version\")  }}. Please check your ESPHome Addon."
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.update_esphome
  mode: single
- id: '1731093150516'
  alias: Button Haustür nur in Zone
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_button.haustur_offnen_geobutton
  conditions:
  - condition: state
    entity_id: sensor.home_christian_fahrtrichtung
    state: arrived
  actions:
  - action: lock.open
    metadata: {}
    data: {}
    target:
      entity_id: lock.haustur
  mode: single
- id: '1731536571734'
  alias: Licht Küche Vorratsraum Test
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.kuche_vorratsraum_bwm_occupancy
    from: 'off'
    to: 'on'
    id: Bewegung
  - trigger: state
    entity_id:
    - binary_sensor.kuche_vorratsraum_bwm_occupancy
    id: Keine Bewegung
    from: 'on'
    to: 'off'
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: switch.kuche_vorratsraum
          state: 'off'
        - condition: trigger
          id:
          - Bewegung
        - condition: numeric_state
          entity_id: sensor.kuche_vorratsraum_bwm_illuminance
          below: 20
      sequence:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.kuche_vorratsraum
    - conditions:
      - condition: trigger
        id:
        - Keine Bewegung
      sequence:
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: switch.kuche_vorratsraum
  mode: single
- id: '1731619614931'
  alias: Licht HSW Bewegung/Tür
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.hmip_spi_000c20c9abc3f3_anwesenheit
    from: 'off'
    to: 'on'
    id: Bewegung
  - trigger: state
    entity_id:
    - binary_sensor.hmip_spi_000c20c9abc3f3_anwesenheit
    id: Keine Bewegung
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 5
  - trigger: state
    entity_id:
    - binary_sensor.hsw_tur
    from: 'off'
    to: 'on'
    id: Tür auf
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Bewegung
        - Tür auf
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.hmip_spi_000c20c9abc3f3_beleuchtungsstarke
          below: 15
        - condition: sun
          before: sunrise
          after: sunset
      sequence:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.hsw_deckenlicht
    - conditions:
      - condition: trigger
        id:
        - Keine Bewegung
      - condition: state
        entity_id: binary_sensor.hsw_tur
        state: 'off'
      sequence:
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: switch.hsw_deckenlicht
  mode: single
- id: '1734095188826'
  alias: Licht Dachboden
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.dachbodenluke
    from: 'off'
    to: 'on'
    id: Luke wird Geöffnet
    for:
      hours: 0
      minutes: 0
      seconds: 1
  - trigger: state
    entity_id:
    - binary_sensor.dachbodenluke
    from: 'on'
    to: 'off'
    id: Luke wird Geschlossen
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Luke wird Geöffnet
      sequence:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.dachboden_licht
    - conditions:
      - condition: trigger
        id:
        - Luke wird Geschlossen
      sequence:
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: switch.dachboden_licht
  mode: single
- id: '1734283603006'
  alias: Warmwasserpumpe
  description: ''
  triggers:
  - trigger: time
    at:
      entity_id: input_datetime.iphonewakeup
      offset: 00:20:00
    id: Einschaltzeit
  - trigger: time
    at: input_datetime.zirkulationspumpe_ausschaltzeit
    id: Ausschaltzeit
  - trigger: state
    entity_id:
    - sensor.christians_iphone_battery_state
    from: Not Charging
    to: Charging
    id: iPhone Nachtzeit
  - trigger: state
    entity_id:
    - person.christian
    id: Anwesenheit
    from: not_home
    to: home
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Ausschaltzeit
      - condition: state
        entity_id: person.christian
        state: not_home
      - condition: state
        entity_id: input_boolean.urlaubsmodus
        state: 'off'
      - condition: state
        entity_id: input_boolean.gastemodus
        state: 'off'
      sequence:
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: switch.warmwasser_umwalzpumpe
    - conditions:
      - condition: trigger
        id:
        - iPhone Nachtzeit
      - condition: state
        entity_id: person.christian
        state: home
      - condition: time
        after: '21:00:00'
        before: 05:00:00
      sequence:
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: switch.warmwasser_umwalzpumpe
    - conditions:
      - condition: trigger
        id:
        - Einschaltzeit
      - condition: state
        entity_id: person.christian
        state: home
      sequence:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.warmwasser_umwalzpumpe
    - conditions:
      - condition: trigger
        id:
        - Anwesenheit
      - condition: state
        entity_id: input_boolean.urlaubsmodus
        state: 'off'
      - condition: state
        entity_id: input_boolean.gastemodus
        state: 'off'
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: person.christian
            state: not_home
            for:
              hours: 0
              minutes: 5
              seconds: 0
          sequence:
          - action: switch.turn_off
            metadata: {}
            data: {}
            target:
              entity_id: switch.warmwasser_umwalzpumpe
        - conditions:
          - condition: state
            entity_id: person.christian
            state: home
          sequence:
          - action: switch.turn_on
            metadata: {}
            data: {}
            target:
              entity_id: switch.warmwasser_umwalzpumpe
  mode: single
- id: '1737998415014'
  alias: Rollläden Urlaubsmodus
  description: Fahre Rollläden im Urlaubs/Schichtmodus bei Sonnenunter.- Aufgang automatisch
  triggers:
  - trigger: sun
    event: sunrise
    offset: 0
    id: Sonne aufgeht
  - trigger: sun
    event: sunset
    offset: 0
    id: Sonne untergeht
  conditions:
  - condition: state
    entity_id: input_boolean.urlaubsmodus
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Sonne untergeht
      sequence:
      - action: cover.close_cover
        metadata: {}
        data: {}
        target:
          entity_id: cover.hmip_broll_2_0036a0c994acdc
    - conditions:
      - condition: trigger
        id:
        - Sonne aufgeht
      sequence:
      - action: cover.open_cover
        metadata: {}
        data: {}
        target:
          entity_id: cover.hmip_broll_2_0036a0c994acdc
  mode: single
- id: '1738770107565'
  alias: Aufwachen Schlafzimmer
  description: ''
  triggers:
  - trigger: time
    at: input_datetime.iphonewakeup
  conditions:
  - condition: state
    entity_id: input_boolean.iphone_alarm_status
    state: 'on'
  - condition: state
    entity_id: person.christian
    state: home
  actions:
  - action: cover.open_cover
    metadata: {}
    data: {}
    target:
      entity_id: cover.hmip_broll_2_0036a0c994acdc
  - if:
    - condition: sun
      before: sunrise
      after: sunset
    then:
    - action: light.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: light.schlafzimmer_stehlampe
  mode: single
- id: '1738835967288'
  alias: Garage ist offen
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - cover.garage_door
    to: open
    from: closed
    for:
      hours: 0
      minutes: 15
      seconds: 0
  conditions: []
  actions:
  - data:
      title: "Sweet Home \U0001F3E1"
      message: Die Garage ist noch offen (bitte gedrückt halten)
      data:
        actions:
        - action: CLOSE_GARAGE
          title: Garage schließen
          icon: sfsymbols:square.and.arrow.down
    action: notify.notify
  - wait_for_trigger:
    - event_type: mobile_app_notification_action
      event_data:
        action: CLOSE_GARAGE
      trigger: event
    timeout:
      hours: 0
      minutes: 15
      seconds: 0
      milliseconds: 0
    continue_on_timeout: false
  - data: {}
    target:
      entity_id: cover.garage_door
    action: cover.close_cover
  mode: single
- id: '1739100287620'
  alias: Battery Notes - Battery Not Reported
  description: ''
  use_blueprint:
    path: andrew-codechimp/battery_notes_battery_not_reported.yaml
    input:
      excluded_devices:
      - null
      user_actions: []
- id: '1739223981965'
  alias: Battery Notes - Battery Threshold
  description: ''
  use_blueprint:
    path: andrew-codechimp/battery_notes_battery_threshold.yaml
    input:
      excluded_devices:
      - null
- id: '1744618679234'
  alias: Kamera Aufnahme Modus
  description: 'Stelle Kamera Aufnahmemodus auf Bewegung wenn Abwesend oder Nacht.
    Bei Anwesenheit & Tag stelle Kamera Aufnahme Modus auf aus. '
  triggers:
  - trigger: state
    entity_id:
    - sensor.nachtzeit
    from: '0'
    to: '1'
    id: Nachtzeit
  - trigger: state
    entity_id:
    - sensor.nachtzeit
    from: '1'
    to: '0'
    id: Tagzeit
  - trigger: zone
    entity_id: person.christian
    zone: zone.home
    event: enter
    id: Anwesend
  - trigger: zone
    entity_id: person.christian
    zone: zone.home
    event: leave
    id: Abwesend
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Tagzeit
      - condition: zone
        entity_id: person.christian
        zone: zone.home
      sequence:
      - action: select.select_option
        metadata: {}
        data:
          option: Never
        target:
          entity_id:
          - select.garage_recording_mode
          - select.hintereingang_recording_mode
    - conditions:
      - condition: trigger
        id:
        - Nachtzeit
      - condition: zone
        entity_id: person.christian
        zone: zone.home
      sequence:
      - action: select.select_option
        metadata: {}
        data:
          option: Detections
        target:
          entity_id:
          - select.garage_recording_mode
          - select.hintereingang_recording_mode
    - conditions:
      - condition: trigger
        id:
        - Anwesend
      - condition: state
        entity_id: sensor.nachtzeit
        state: '0'
      sequence:
      - action: select.select_option
        metadata: {}
        data:
          option: Never
        target:
          entity_id:
          - select.garage_recording_mode
          - select.hintereingang_recording_mode
    - conditions:
      - condition: trigger
        id:
        - Abwesend
      sequence:
      - action: select.select_option
        metadata: {}
        data:
          option: Detections
        target:
          entity_id:
          - select.garage_recording_mode
          - select.hintereingang_recording_mode
  mode: single
